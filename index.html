<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bullet Programming Shooter</title>
    <link rel="stylesheet" href="style.css">
    <!-- Try multiple CDN sources for better reliability -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.70.0/phaser.min.js" 
            onerror="this.onerror=null; this.src='https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js'"></script>
</head>
<body>
    <!-- Main Game Container (Full Screen) -->
    <div id="game-container">
        <div id="game-canvas"></div>
    </div>

    <!-- Game HUD -->
    <div id="hud">
        <div id="score">Score: 0</div>
        <div id="stage">Stage: 1</div>
        <button id="open-rpa-editor" class="hud-button">🔧 RPA編集</button>
    </div>

    <!-- RPA Editor Modal -->
    <div id="rpa-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>🚀 弾丸プログラミング</h2>
                <button id="close-rpa-editor" class="close-button">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="editor-layout">
                    <!-- Node Palette -->
                    <div class="node-palette-section">
                        <h3>ノードパレット</h3>
                        <div id="node-palette">
                            <div class="node-category">
                                <h4>⏰ WHEN (いつ)</h4>
                                <div class="node-grid">
                                    <div class="node" data-type="when" data-action="immediate">即座に</div>
                                    <div class="node" data-type="when" data-action="timer-1">1秒後</div>
                                    <div class="node" data-type="when" data-action="timer-2">2秒後</div>
                                    <div class="node" data-type="when" data-action="enemy-contact">敵に接触時</div>
                                    <div class="node" data-type="when" data-action="wall-contact">壁に接触時</div>
                                </div>
                            </div>
                            
                            <div class="node-category">
                                <h4>🤔 IF (もし)</h4>
                                <div class="node-grid">
                                    <div class="node" data-type="if" data-action="enemy-near">敵が近い</div>
                                    <div class="node" data-type="if" data-action="enemy-far">敵が遠い</div>
                                    <div class="node" data-type="if" data-action="enemy-many">敵が3体以上</div>
                                    <div class="node" data-type="if" data-action="no-enemy">敵がいない</div>
                                </div>
                            </div>
                            
                            <div class="node-category">
                                <h4>⚡ DO (実行)</h4>
                                <div class="node-grid">
                                    <div class="node" data-type="do" data-action="split">分裂する</div>
                                    <div class="node" data-type="do" data-action="explode">爆発する</div>
                                    <div class="node" data-type="do" data-action="bounce">跳ね返る</div>
                                    <div class="node" data-type="do" data-action="speed-up">速くなる</div>
                                    <div class="node" data-type="do" data-action="destroy">消える</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Program Slots -->
                    <div class="program-section">
                        <h3>プログラムスロット</h3>
                        <div id="rpa-slots">
                            <div class="slot-container">
                                <h4>スロット 1</h4>
                                <div class="slot" data-slot="0">
                                    <span class="slot-placeholder">ノードをここにドラッグ</span>
                                </div>
                            </div>
                            <div class="slot-container">
                                <h4>スロット 2</h4>
                                <div class="slot" data-slot="1">
                                    <span class="slot-placeholder">ノードをここにドラッグ</span>
                                </div>
                            </div>
                            <div class="slot-container">
                                <h4>スロット 3</h4>
                                <div class="slot" data-slot="2">
                                    <span class="slot-placeholder">ノードをここにドラッグ</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Control Buttons -->
                        <div class="editor-controls">
                            <button id="clear-program" class="control-button danger">🗑️ 全てクリア</button>
                            <button id="test-fire" class="control-button primary">🚀 テスト発射</button>
                            <button id="save-and-close" class="control-button success">✓ 保存して閉じる</button>
                        </div>
                    </div>
                </div>
                
                <!-- Example Programs -->
                <div class="examples-section">
                    <h3>📚 プログラム例</h3>
                    <div class="example-grid">
                        <div class="example-card" data-example="timer-bomb">
                            <h4>時限爆弾</h4>
                            <p>[2秒後] → [爆発する]</p>
                        </div>
                        <div class="example-card" data-example="bounce-bullet">
                            <h4>跳弾</h4>
                            <p>[壁に接触時] → [跳ね返る]</p>
                        </div>
                        <div class="example-card" data-example="smart-split">
                            <h4>賢い分裂弾</h4>
                            <p>[1秒後] → [敵が3体以上] → [分裂する]</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Debug info for troubleshooting -->
    <div id="debug-info" style="position: absolute; top: 120px; left: 10px; color: white; font-size: 12px; background: rgba(0,0,0,0.7); padding: 5px; border-radius: 3px;">
        <div>Phaser loaded: <span id="phaser-status">checking...</span></div>
        <div>Game initialized: <span id="game-status">waiting...</span></div>
    </div>

    <script>
        // Debug check for Phaser
        document.getElementById('phaser-status').textContent = typeof Phaser !== 'undefined' ? 'YES' : 'NO';
        
        // Log any errors
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
        });
    </script>

    <script src="js/rpa.js"></script>
    <script src="js/bullet.js"></script>
    <script src="js/game.js"></script>
</body>
</html>